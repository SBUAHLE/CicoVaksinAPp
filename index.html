<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CICO Vaksinasi</title>

<style>
:root{
  --bg:#f5f7ff;
  --card:#ffffff;
  --line:#e6ecff;
  --primary:#4f46e5;
  --primary-weak:#eef2ff;
  --text:#1f2937;
  --muted:#6b7280;
  --ok:#059669;
  --warn:#b45309;
  --danger:#ef4444;
}

html,body{
  margin:0;
  padding:0;
  background:var(--bg);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  color:var(--text);
}

.container{
  max-width:820px;
  margin:28px auto;
  padding:0 18px;
}

h1{font-size:26px}
h2{font-size:22px}
.note{color:var(--muted)}

.card{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:14px;
  padding:18px;
  margin-bottom:16px;
}

label{font-weight:600;margin-top:10px;display:block}
input,textarea,select{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:1px solid var(--line);
  font-size:16px;
}
input[readonly]{background:#f8f9ff}

textarea{min-height:90px}

.hidden{display:none}

.btn{
  padding:12px 16px;
  border-radius:12px;
  border:0;
  font-weight:600;
  cursor:pointer;
}
.btn-primary{background:var(--primary);color:#fff}
.btn-ghost{background:var(--primary-weak)}
.btn-link{background:none;color:var(--primary);text-decoration:underline}

.hero{
  display:flex;
  gap:16px;
  margin-top:16px;
  flex-wrap:wrap;
}

.big{
  flex:1 1 300px;
  padding:24px;
  border-radius:16px;
  font-size:24px;
  font-weight:800;
  cursor:pointer;
}

.big.in{background:#e7f6ef;color:#0b8a50}
.big.out{background:#fff5f5;color:#b42318}

.row{display:flex;gap:10px;flex-wrap:wrap}
.stack{display:flex;flex-direction:column;gap:10px}
.status{font-size:14px;color:var(--muted)}
.badge{font-size:13px;padding:4px 10px;border-radius:999px;background:#eef2ff}

.bar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:8px;
}
</style>
</head>

<body>
<div class="container">

<!-- HOME -->
<div id="view-home">
  <h1>CICO Vaksinasi</h1>
  <p class="note">Silakan pilih proses.</p>

  <div class="hero">
    <button class="big in" onclick="showView('checkin')">CEK-IN</button>
    <button class="big out" onclick="showView('checkout')">CEK-OUT</button>
  </div>
</div>

<!-- CHECK IN -->
<div id="view-checkin" class="hidden">
  <div class="bar">
    <button class="btn-link" onclick="showView('home')">← Kembali</button>
    <h2>Form Cek-In</h2>
    <span></span>
  </div>

  <div class="card stack">
    <label>Nomor Order *</label>
    <input id="ci_order">

    <label>Nama Vaksinator</label>
    <input id="ci_nama">

    <label>Waktu Server</label>
    <input id="ci_time" readonly>
    <div class="status" id="ci_timeStatus"></div>

    <div class="row">
      <div>
        <label>Latitude</label>
        <input id="ci_lat" readonly>
      </div>
      <div>
        <label>Longitude</label>
        <input id="ci_lng" readonly>
      </div>
    </div>

    <span class="badge" id="ci_locBadge">Lokasi: -</span>
    <div class="status" id="ci_gpsStatus"></div>

    <label>Catatan</label>
    <textarea id="ci_catatan"></textarea>

    <div class="row">
      <button class="btn btn-primary" onclick="submitCheckIn()">Kirim</button>
      <button class="btn" onclick="resetCheckIn()">Reset</button>
    </div>
  </div>
</div>

<!-- CHECK OUT -->
<div id="view-checkout" class="hidden">
  <div class="bar">
    <button class="btn-link" onclick="showView('home')">← Kembali</button>
    <h2>Form Cek-Out</h2>
    <span></span>
  </div>

  <div class="card stack">
    <label>Nomor Order *</label>
    <input id="co_order">

    <label>Nama Vaksinator</label>
    <input id="co_nama">

    <label>Waktu Server</label>
    <input id="co_time" readonly>
    <div class="status" id="co_timeStatus"></div>

    <div class="row">
      <div>
        <label>Latitude</label>
        <input id="co_lat" readonly>
      </div>
      <div>
        <label>Longitude</label>
        <input id="co_lng" readonly>
      </div>
    </div>

    <span class="badge" id="co_locBadge">Lokasi: -</span>
    <div class="status" id="co_gpsStatus"></div>

    <label>Catatan</label>
    <textarea id="co_catatan"></textarea>

    <div class="row">
      <button class="btn btn-primary" onclick="submitCheckOut()">Kirim</button>
      <button class="btn" onclick="resetCheckOut()">Reset</button>
    </div>
  </div>
</div>

</div>

<script>
const FLOW_URL = 'PASTE_URL_FLOW_DI_SINI';

function showView(v){
  ['home','checkin','checkout'].forEach(id=>{
    document.getElementById('view-'+id).classList.toggle('hidden', v!==id);
  });
  if(v==='checkin') initCI();
  if(v==='checkout') initCO();
}

function initCI(){
  serverTime('ci_time','ci_timeStatus');
  gps('ci_lat','ci_lng','ci_gpsStatus','ci_locBadge');
}
function initCO(){
  serverTime('co_time','co_timeStatus');
  gps('co_lat','co_lng','co_gpsStatus','co_locBadge');
}

async function serverTime(id,st){
  try{
    const r=await fetch('https://worldtimeapi.org/api/timezone/Asia/Jakarta');
    const j=await r.json();
    document.getElementById(id).value=j.datetime;
    document.getElementById(st).textContent='Waktu server OK';
  }catch{
    document.getElementById(id).value=new Date().toISOString();
    document.getElementById(st).textContent='Fallback waktu lokal';
  }
}

function gps(lat,lng,st,badge){
  if(!navigator.geolocation) return ip(lat,lng,st,badge);
  navigator.geolocation.getCurrentPosition(
    p=>{
      document.getElementById(lat).value=p.coords.latitude.toFixed(6);
      document.getElementById(lng).value=p.coords.longitude.toFixed(6);
      document.getElementById(badge).textContent='Lokasi: GPS';
      document.getElementById(st).textContent='GPS OK';
    },
    ()=>ip(lat,lng,st,badge)
  );
}

async function ip(lat,lng,st,badge){
  try{
    const r=await fetch('https://ipapi.co/json/');
    const j=await r.json();
    document.getElementById(lat).value=j.latitude;
    document.getElementById(lng).value=j.longitude;
    document.getElementById(badge).textContent='Lokasi: IP';
    document.getElementById(st).textContent='Lokasi perkiraan';
  }catch{
    document.getElementById(st).textContent='Lokasi gagal';
  }
}

function submitCheckIn(){alert('Submit CI')}
function submitCheckOut(){alert('Submit CO')}
function resetCheckIn(){location.reload()}
function resetCheckOut(){location.reload()}
</script>
</body>
</html>
