<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CICO Vaksinasi</title>

<style>
:root{
  --bg:#f5f7ff;--card:#fff;--line:#e6ecff;
  --primary:#4f46e5;--primary-weak:#eef2ff;
  --text:#1f2937;--muted:#6b7280;
  --ok:#059669;--danger:#ef4444;
}
html,body{margin:0;background:var(--bg);font-family:system-ui;color:var(--text)}
.container{max-width:820px;margin:28px auto;padding:0 18px}
h1{font-size:26px} h2{font-size:22px}
.note{color:var(--muted)}
.card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:18px;margin-bottom:16px}
label{font-weight:600;margin-top:10px;display:block}
input,textarea,select{
  width:100%;padding:12px;border-radius:10px;
  border:1px solid var(--line);font-size:16px
}
input[readonly]{background:#f8f9ff}
textarea{min-height:90px}
.hidden{display:none}
.btn{padding:12px 16px;border-radius:12px;border:0;font-weight:600;cursor:pointer}
.btn-primary{background:var(--primary);color:#fff}
.btn-ghost{background:var(--primary-weak)}
.btn-link{background:none;color:var(--primary);text-decoration:underline}
.hero{display:flex;gap:16px;margin-top:16px;flex-wrap:wrap}
.big{flex:1 1 300px;padding:24px;border-radius:16px;font-size:24px;font-weight:800;cursor:pointer}
.big.in{background:#e7f6ef;color:#0b8a50}
.big.out{background:#fff5f5;color:#b42318}
.row{display:flex;gap:10px;flex-wrap:wrap}
.stack{display:flex;flex-direction:column;gap:10px}
.status{font-size:14px;color:var(--muted)}
.badge{font-size:13px;padding:4px 10px;border-radius:999px;background:#eef2ff}
.bar{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}

/* VALIDATION */
.invalid{border:2px solid var(--danger)!important}
.warn-box{
  background:#fff5f5;
  color:#b42318;
  padding:10px 14px;
  border-radius:10px;
  font-weight:600;
  margin-bottom:10px;
}
</style>
</head>

<body>
<div class="container">

<!-- HOME -->
<div id="view-home">
  <h1>CICO Vaksinasi</h1>
  <p class="note">Silakan pilih proses</p>
  <div class="hero">
    <button class="big in" onclick="showView('checkin')">CEK-IN</button>
    <button class="big out" onclick="showView('checkout')">CEK-OUT</button>
  </div>
</div>

<!-- CEK IN -->
<div id="view-checkin" class="hidden">
  <div class="bar">
    <button class="btn-link" onclick="showView('home')">← Kembali</button>
    <h2>Form Cek-In</h2><span></span>
  </div>

  <div id="ci_warn" class="warn-box hidden">⚠️ Semua kolom wajib diisi</div>

  <div class="card stack">
    <input id="ci_order" placeholder="Nomor Order *">
    <input id="ci_nama" placeholder="Nama Vaksinator *">
    <input id="ci_time" readonly placeholder="Waktu Server *">
    <div class="row">
      <input id="ci_lat" readonly placeholder="Latitude *">
      <input id="ci_lng" readonly placeholder="Longitude *">
    </div>

    <select id="ci_kondisi">
      <option value="">-- Kondisi Vaksin * --</option>
      <option>Baik</option>
      <option>Perlu Pendinginan</option>
      <option>Rusak</option>
    </select>

    <div id="ci_batchWrap" class="stack"></div>
    <button class="btn btn-ghost" onclick="addBatch('ci_batchWrap')">+ Tambah Batch</button>

    <textarea id="ci_catatan" placeholder="Catatan *"></textarea>

    <button class="btn btn-primary" onclick="submitCheckIn()">Kirim</button>
  </div>
</div>

<!-- CEK OUT -->
<div id="view-checkout" class="hidden">
  <div class="bar">
    <button class="btn-link" onclick="showView('home')">← Kembali</button>
    <h2>Form Cek-Out</h2><span></span>
  </div>

  <div id="co_warn" class="warn-box hidden">⚠️ Semua kolom wajib diisi</div>

  <div class="card stack">
    <input id="co_order" placeholder="Nomor Order *">
    <input id="co_nama" placeholder="Nama Vaksinator *">
    <input id="co_time" readonly placeholder="Waktu Server *">

    <div class="row">
      <input id="co_lat" readonly placeholder="Latitude *">
      <input id="co_lng" readonly placeholder="Longitude *">
    </div>

    <input id="co_kandang" placeholder="No Kandang *">
    <input type="number" id="co_jmlAyam" placeholder="Jumlah Ayam Tervaksin *">
    <input type="number" id="co_jmlVaksin" placeholder="Jumlah Vaksin Terpakai *">

    <div id="co_batchWrap" class="stack"></div>
    <button class="btn btn-ghost" onclick="addBatch('co_batchWrap')">+ Tambah Batch</button>

    <textarea id="co_catatan" placeholder="Catatan *"></textarea>

    <button class="btn btn-primary" onclick="submitCheckOut()">Kirim</button>
  </div>
</div>

</div>

<script>
function showView(v){
  ['home','checkin','checkout'].forEach(id=>{
    document.getElementById('view-'+id).classList.toggle('hidden',v!==id)
  })
  if(v==='checkin') initCI()
  if(v==='checkout') initCO()
}

async function initCI(){time('ci_time');gps('ci_lat','ci_lng')}
async function initCO(){time('co_time');gps('co_lat','co_lng')}

async function time(id){
  try{
    const r=await fetch('https://worldtimeapi.org/api/timezone/Asia/Jakarta')
    const j=await r.json()
    document.getElementById(id).value=j.datetime
  }catch{
    document.getElementById(id).value=new Date().toISOString()
  }
}

function gps(lat,lng){
  if(!navigator.geolocation) return
  navigator.geolocation.getCurrentPosition(p=>{
    document.getElementById(lat).value=p.coords.latitude.toFixed(6)
    document.getElementById(lng).value=p.coords.longitude.toFixed(6)
  })
}

function addBatch(wrap){
  const i=document.createElement('input')
  i.placeholder='Nomor Batch *'
  document.getElementById(wrap).appendChild(i)
}

/* ===== VALIDATION ===== */
function validate(ids, warnId){
  let valid=true
  document.getElementById(warnId).classList.add('hidden')
  ids.forEach(id=>{
    const el=document.getElementById(id)
    el.classList.remove('invalid')
    if(!el.value){
      el.classList.add('invalid')
      valid=false
    }
  })
  if(!valid) document.getElementById(warnId).classList.remove('hidden')
  return valid
}

function submitCheckIn(){
  const batchFilled=[...document.querySelectorAll('#ci_batchWrap input')].every(i=>i.value)
  const ok=validate(
    ['ci_order','ci_nama','ci_time','ci_lat','ci_lng','ci_kondisi','ci_catatan'],
    'ci_warn'
  ) && batchFilled

  if(!ok) document.getElementById('ci_warn').classList.remove('hidden')
  else alert('Cek-In valid & siap dikirim')
}

function submitCheckOut(){
  const batchFilled=[...document.querySelectorAll('#co_batchWrap input')].every(i=>i.value)
  const ok=validate(
    ['co_order','co_nama','co_time','co_lat','co_lng','co_kandang','co_jmlAyam','co_jmlVaksin','co_catatan'],
    'co_warn'
  ) && batchFilled

  if(!ok) document.getElementById('co_warn').classList.remove('hidden')
  else alert('Cek-Out valid & siap dikirim')
}
</script>
</body>
</html>
