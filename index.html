<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CICO Vaksinasi</title>

<style>
body{margin:0;background:#f5f7ff;font-family:system-ui}
.container{max-width:900px;margin:24px auto;padding:0 16px}
h1,h2{margin:10px 0}
.card{background:#fff;border-radius:14px;padding:18px;margin-bottom:16px}
label{font-weight:600;margin-top:10px;display:block}
input,select,textarea{
  width:100%;padding:12px;border-radius:10px;
  border:1px solid #dbe3ff;font-size:15px
}
input[readonly]{background:#f2f4ff}
textarea{min-height:90px}
.row{display:flex;gap:10px;flex-wrap:wrap}
.hidden{display:none}
.btn{padding:12px 16px;border-radius:12px;border:0;font-weight:600;cursor:pointer}
.btn-primary{background:#4f46e5;color:#fff}
.btn-back{background:none;color:#4f46e5;font-weight:600}
.warn{background:#fff5f5;color:#b42318;padding:10px;border-radius:10px;margin-bottom:10px}
</style>
</head>

<body>
<div class="container">

<!-- HOME -->
<div id="view-home">
  <h1>CICO Vaksinasi</h1>
  <button class="btn btn-primary" onclick="show('checkin')">CEK-IN</button>
  <button class="btn btn-primary" onclick="show('checkout')">CEK-OUT</button>
</div>

<!-- CEK IN -->
<div id="view-checkin" class="hidden">
  <button class="btn-back" onclick="show('home')">← Kembali</button>
  <h2>Form Cek-In</h2>

  <div id="ci_warn" class="warn hidden"></div>

  <div class="card">
    <input id="ci_order" placeholder="Nomor Order *">
    <input id="ci_nama" placeholder="Nama Vaksinator *">

    <div class="row">
      <input id="ci_tanggal" readonly placeholder="Tanggal *">
      <input id="ci_jam" readonly placeholder="Jam (24 Jam) *">
    </div>

    <input id="ci_lokasi" readonly placeholder="Nama Lokasi *">

    <div class="row">
      <input id="ci_lat" readonly placeholder="Latitude *">
      <input id="ci_lng" readonly placeholder="Longitude *">
    </div>

    <select id="ci_kondisi">
      <option value="">-- Kondisi Vaksin * --</option>
      <option>Baik</option>
      <option>Perlu Pendinginan</option>
      <option>Rusak</option>
      <option>Thawing</option>
      <option>Tidak Thawing</option>
    </select>

    <input id="ci_batch" placeholder="Nomor Batch Vaksin *">

    <label>Foto Bukti *</label>
    <input type="file" id="ci_foto" accept="image/*">

    <textarea id="ci_catatan" placeholder="Catatan *"></textarea>

    <button class="btn btn-primary" onclick="submitCI()">Kirim</button>
  </div>
</div>

<!-- CEK OUT -->
<div id="view-checkout" class="hidden">
  <button class="btn-back" onclick="show('home')">← Kembali</button>
  <h2>Form Cek-Out</h2>

  <div id="co_warn" class="warn hidden"></div>

  <div class="card">
    <input id="co_order" placeholder="Nomor Order *">
    <input id="co_nama" placeholder="Nama Vaksinator *">

    <div class="row">
      <input id="co_tanggal" readonly placeholder="Tanggal *">
      <input id="co_jam" readonly placeholder="Jam (24 Jam) *">
    </div>

    <input id="co_lokasi" readonly placeholder="Nama Lokasi *">

    <div class="row">
      <input id="co_lat" readonly placeholder="Latitude *">
      <input id="co_lng" readonly placeholder="Longitude *">
    </div>

    <input id="co_kandang" placeholder="No Kandang *">
    <input id="co_ayam" type="number" placeholder="Jumlah Ayam Tervaksin *">
    <input id="co_vaksin" type="number" placeholder="Jumlah Vaksin Terpakai *">

    <label>Foto Bukti *</label>
    <input type="file" id="co_foto" accept="image/*">

    <textarea id="co_catatan" placeholder="Catatan *"></textarea>

    <button class="btn btn-primary" onclick="submitCO()">Kirim</button>
  </div>
</div>

</div>

<script>
function show(v){
  ['home','checkin','checkout'].forEach(x=>{
    document.getElementById('view-'+x).classList.toggle('hidden',v!==x)
  })
  if(v==='checkin') initCI()
  if(v==='checkout') initCO()
}

function formatTanggal(d){
  return d.toLocaleDateString('id-ID',{day:'2-digit',month:'long',year:'numeric'})
}
function formatJam(d){
  return d.toLocaleTimeString('id-ID',{hour:'2-digit',minute:'2-digit',hour12:false})
}

function initCI(){initTime('ci');initLoc('ci')}
function initCO(){initTime('co');initLoc('co')}

function initTime(p){
  const now=new Date()
  document.getElementById(p+'_tanggal').value=formatTanggal(now)
  document.getElementById(p+'_jam').value=formatJam(now)
}

function initLoc(p){
  navigator.geolocation.getCurrentPosition(async pos=>{
    document.getElementById(p+'_lat').value=pos.coords.latitude.toFixed(6)
    document.getElementById(p+'_lng').value=pos.coords.longitude.toFixed(6)

    try{
      const r=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${pos.coords.latitude}&lon=${pos.coords.longitude}`)
      const j=await r.json()
      document.getElementById(p+'_lokasi').value=j.display_name
    }catch{
      document.getElementById(p+'_lokasi').value='Lokasi tidak tersedia'
    }
  })
}

function submitCI(){
  const req=['ci_order','ci_nama','ci_tanggal','ci_jam','ci_lokasi','ci_lat','ci_lng','ci_kondisi','ci_batch','ci_catatan']
  if(req.some(id=>!document.getElementById(id).value)||ci_foto.files.length===0){
    ci_warn.textContent='⚠️ Semua kolom wajib diisi'
    ci_warn.classList.remove('hidden');return
  }
  alert('✅ Cek-In berhasil')
  show('home')
}

function submitCO(){
  const req=['co_order','co_nama','co_tanggal','co_jam','co_lokasi','co_lat','co_lng','co_kandang','co_ayam','co_vaksin','co_catatan']
  if(req.some(id=>!document.getElementById(id).value)||co_foto.files.length===0){
    co_warn.textContent='⚠️ Semua kolom wajib diisi'
    co_warn.classList.remove('hidden');return
  }
  alert('✅ Cek-Out berhasil')
  show('home')
}
</script>

</body>
</html>
